---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by aaa.
--- DateTime: 2018/11/14 14:28
---
local UIMask = BaseClass("UIMask", Singleton)

local function CheckMaskWindow(self)
    if self.is_open == false and table.count(self.mask)>0 then
        self.is_open = true
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIMask)
    elseif self.is_open and table.count(self.mask)==0 then
        self.is_open = false
        UIManager:GetInstance():CloseWindow(UIWindowNames.UIMask)
    end
end

--local function ActiveWindow(self,target)
--    if target.Name == "UIMask" then
--        self.is_load = false
--        CheckMaskWindow(self)
--    end
--end

local function __init(self)
    -- 所有服务器列表
    self.mask = {}
    self.empty_mask = {}
    self.is_open = false
    --self.bindFunc = Bind(self,ActiveWindow)
    --UIManager:GetInstance():AddListener(UIMessageNames.UIFRAME_ON_WINDOW_OPEN,self.bindFunc)
end

local function CloseMask(self,type)
    --Logger.LogErrorVars(" CloseMask : "," type ",type," : ",self.mask)
    table.removebyvalue(self.mask,type)
    CheckMaskWindow(self)
end
local function ShowMask(self,type)
    --Logger.LogErrorVars(" ShowMask : "," type ",type," : ",self.mask)
    if not table.indexof(self.mask,type) then
        table.insert(self.mask,type)
    end
    CheckMaskWindow(self)
end
--初始化空遮罩
local function InitEmptyMask(self)
    GameObjectPool:GetInstance():GetGameObjectAsync("UI/Prefabs/Common/EmptyMask.prefab",function (go)
        if not IsNull(go) then
            self.mask_empty_game = go
            local layer =  UIManager:GetInstance():GetLayer(UILayers.TipLayer.Name)
            local trans = go.transform
            trans:SetParent(layer.transform)
            trans.localScale = Vector3.New(1,1,1)
            local rect_trans = UIUtil.FindComponent(trans,typeof(CS.UnityEngine.RectTransform))
            rect_trans.anchorMin = Vector2.New(0,0);
            rect_trans.anchorMax = Vector2.New(1,1);
            rect_trans.pivot = Vector2.New(0.5,0.5);
            rect_trans.anchoredPosition3D = Vector3.New(0,0,0)
            rect_trans.sizeDelta = Vector2.New(0,0);
            self.mask_empty_game:SetActive(false)
        end
    end)

end

local function CheckEmptyMaskWindow(self)
    if table.count(self.empty_mask)>0 then
        self.mask_empty_game:SetActive(true)
    elseif table.count(self.empty_mask)==0 then
       self.mask_empty_game:SetActive(false)
    end
end

local function CloseEmptyMask(self,type)
    table.removebyvalue(self.empty_mask,type)
    CheckEmptyMaskWindow(self)
end
--显示空遮罩
local function ShowEmptyMask(self,type)
    if not table.indexof(self.empty_mask,type) then
        table.insert(self.empty_mask,type)
    end
    CheckEmptyMaskWindow(self)
end
UIMask.ShowEmptyMask = ShowEmptyMask
UIMask.CloseEmptyMask = CloseEmptyMask
UIMask.ShowMask = ShowMask
UIMask.CloseMask = CloseMask
UIMask.__init = __init
UIMask.InitEmptyMask = InitEmptyMask
return UIMask