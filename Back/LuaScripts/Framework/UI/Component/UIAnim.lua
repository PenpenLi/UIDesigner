---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by aaa.
--- DateTime: 2018/12/4 13:39
---
local UIAnim = BaseClass("UIAnim", UIBaseContainer)
local base = UIBaseContainer

local function OnCreate(self, relative_path)
    base.OnCreate(self)
    -- Unity侧原生组件
    self.unity_anim = UIUtil.FindComponent(self.transform, typeof(CS.UnityEngine.Animator), relative_path)

    if not IsNull(self.unity_anim)   then
        self.unity_anim.enabled = false
        if IsNull(self.gameObject) then
            self.gameObject = self.unity_anim.gameObject
            self.transform = self.unity_anim.transform
        end

    end
end
local function Play(self,anim_name,layer,normalized,times,interval)
    if self.timer_arg ~= nil then
        TimerManager:GetInstance():SimpleTimerStop(self.timer_arg)
        self.timer_arg = nil
    end
    self.unity_anim.enabled = true
    self.play_anim = anim_name
    if layer == nil then
        layer = 0
    end
    if normalized == nil then
        normalized = 0
    end
    self.unity_anim:Play(anim_name,layer,normalized)
    if interval == nil then
        if times ~= nil then
            self.play_times = times
        else
            self.play_times = 1
        end
    else
        self.play_times = 0
        local cur_times = 0
        self.timer_arg = TimerManager:GetInstance():SimpleTimerArgs(interval,function(go)
            cur_times = cur_times+1
            if cur_times == times then
                TimerManager:GetInstance():SimpleTimerStop(self.timer_arg)
                self.unity_anim.enabled = false
                self.timer_arg = nil
            else
                self.unity_anim:Play(anim_name,0,0)
            end
        end)
    end

end

local function Update(self)
    if self.play_times ~= nil and self.play_times > 0 then
        local info =  self.unity_anim:GetCurrentAnimatorStateInfo(0);
        if info:IsName(self.play_anim) then
            if info.normalizedTime > 1 then
                self.play_times = self.play_times-1
                if self.play_times > 0 then
                    self.unity_anim:Play(self.play_anim,0,0)
                else
                    self.unity_anim.enabled = false
                end
            end
        end
    end
end

UIAnim.OnCreate = OnCreate
UIAnim.Update = Update
UIAnim.Play = Play
return UIAnim
