---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by aaa.
--- DateTime: 2018/12/19 10:03
---

--[[
-- added by wsh @ 2017-12-08
-- Lua侧UIEventTrigger
-- 使用方式：
-- self.xxx_text = self:AddComponent(UIInput, var_arg)--添加孩子，各种重载方式查看UIBaseContainer
-- TODO：本地化支持
--]]

local UIEventTrigger = BaseClass("UIEventTrigger", UIBaseComponent)
local base = UIBaseComponent
local EventTriggerType = CS.UnityEngine.EventSystems.EventTriggerType;
local EventTrigger=CS.UnityEngine.EventSystems.EventTrigger;

local durationThreshold=0.2;
-- 创建
local function OnCreate(self, relative_path)
    base.OnCreate(self)
    -- Unity侧原生组件
    self.unity_uieventtrigger = UIUtil.FindComponent(self.transform,typeof(EventTrigger),relative_path)
    if self.unity_uieventtrigger ~= nil then
        CS.UnityEngine.GameObject.Destroy(self.unity_uieventtrigger);
    end
    if relative_path ~= nil and #relative_path > 0 then
        self.unity_uieventtrigger = UIUtil.FindTrans(relative_path).gameObject:AddComponent(typeof(EventTrigger))
    else
        self.unity_uieventtrigger = self.gameObject:AddComponent(typeof(EventTrigger))
    end
    self:EnableUpdate(true);
end

local function Update(self)
    if self.isPointerDown==true and Time.time-self.timePressStared>=durationThreshold then
        if self.callback~=nil then
            if self.isFirstExcute then
                if self.callback~=nil then
                    self.callback()
                end

                self.curTime=Time.time;
                if self.isExecuteOnce then
                    self.isPointerDown=false;
                end
                self.isFirstExcute=false;
            else
                if Time.time-self.curTime>=self.durationTime then
                    if self.callback~=nil then
                        self.callback()
                    end
                    self.curTime=Time.time;
                end
            end
        end
    end
end

--注册事件
local function RegesterAction(self,eventId,...)
    local eventEntry=EventTrigger.Entry();
    eventEntry.eventID=eventId;
    eventEntry.callback:AddListener(Bind(...));
    self.unity_uieventtrigger.triggers:Add(eventEntry);
end

--抬起
local function BtnUp(self)
    self.isPointerDown=false;
    self.isFirstExcute=false;
    if self.endCallback~=nil then
        self.endCallback();
    end
end
--按下
local function BtnDown(self)
    self.timePressStared=Time.time;
    self.isPointerDown=true;
    self.isFirstExcute=true;
end

local function BtnExit(self)
    self.isPointerDown=false;
    self.isFirstExcute=false;
end

local function OnDrag(self,base_event)
    self.scrollRect:OnDrag(base_event);
end

local function OnBeginDrag(self,base_event)
    self.scrollRect:OnBeginDrag(base_event);

end
local function OnEndDrag(self,base_event)
    self.scrollRect:OnEndDrag(base_event);
end

local function SetOnLongPress(self,callback,endCallBack,isExecuteOnce,durationTime,_scrollRect,_isNeedDrag)
    RegesterAction(self,EventTriggerType.PointerDown,self,BtnDown);
    RegesterAction(self,EventTriggerType.PointerUp,self,BtnUp);
    RegesterAction(self,EventTriggerType.PointerExit,self,BtnExit);
    self.callback=callback;
    self.endCallback=endCallBack;
    self.isExecuteOnce=isExecuteOnce;
    self.durationTime=durationTime;
    self.scrollRect=_scrollRect;
    if _scrollRect~=nil and _isNeedDrag then
        RegesterAction(self,EventTriggerType.Drag,self,OnDrag);
        RegesterAction(self,EventTriggerType.BeginDrag,self,OnBeginDrag);
        RegesterAction(self,EventTriggerType.EndDrag,self,OnEndDrag);
    end
end
--抬起按钮
local function SetOnPointerUp(self,...)
    RegesterAction(self,EventTriggerType.PointerUp,...);
end

local function SetOnPointerDown(self,...)
    RegesterAction(self,EventTriggerType.PointerDown,...);
end
local function SetOnBeginDrag(self,...)
    RegesterAction(self,EventTriggerType.BeginDrag,...);
end
local function SetOnEndDrag(self,...)
    RegesterAction(self,EventTriggerType.EndDrag,...);
end
local function SetOnDrag(self,...)
    RegesterAction(self,EventTriggerType.Drag,...);
end
local function SetOnPointerExit(self,...)
    RegesterAction(self,EventTriggerType.PointerExit,...);
end

local function SetOnPointerClick(self,...)
    RegesterAction(self,EventTriggerType.PointerClick,...);
end
-- 销毁
local function OnDestroy(self)
    self.unity_uieventtrigger = nil
    base.OnDestroy(self)
end
UIEventTrigger.SetOnPointerDown = SetOnPointerDown
UIEventTrigger.SetOnPointerUp = SetOnPointerUp
UIEventTrigger.SetOnBeginDrag = SetOnBeginDrag
UIEventTrigger.SetOnEndDrag = SetOnEndDrag
UIEventTrigger.SetOnDrag = SetOnDrag
UIEventTrigger.SetOnPointerExit = SetOnPointerExit
UIEventTrigger.SetOnPointerClick=SetOnPointerClick;
UIEventTrigger.OnCreate = OnCreate
UIEventTrigger.OnDestroy = OnDestroy
UIEventTrigger.SetOnLongPress=SetOnLongPress;
UIEventTrigger.Update=Update;
UIEventTrigger.BtnUp= BtnUp

return UIEventTrigger