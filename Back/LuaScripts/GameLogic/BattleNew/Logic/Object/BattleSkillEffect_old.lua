---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guoyu.
--- DateTime: 2018/12/12 14:16
---

local BattleSkillEffect=BaseClass("BattleSkillEffect")

local function __init(self)
    --所处角色
    self.owner=nil
    --效果ID
    self.effectId=0
    --层数
    self.layer=0
    --持续时间
    self.lastTime=0
    ----触发接口
    --self.release=nil
    --是否移除
    self.isRemove=false
    self.value = 0
    self.maxValue = 0
end

local function ReleaseHandler(self,serverRelease,param2,param3)
    --Time.timeScale=0.5
    if serverRelease.typeId==1 then--伤害
        if param2~=nil then
            self.owner:OpreateHp(Mathf.Ceil(serverRelease.hp*param2),serverRelease.isCrit,serverRelease.hurtType)
        else
            self.owner:OpreateHp(serverRelease.hp,serverRelease.isCrit,serverRelease.hurtType)
        end
    elseif serverRelease.typeId==2 then--治疗
        if serverRelease.hp ~= 0 then
            self.owner:OpreateHp(serverRelease.hp,serverRelease.isCrit,serverRelease.hurtType)
        end
    elseif serverRelease.typeId==3 then--恢复水晶
        local cryChangeMine={["add"]={}}
        local cryChangeEnemy={["add"]={}}
        local type = serverRelease.crytal.type
        local count = serverRelease.crytal.count
        if self.owner.playerType==BattleEnum.BattlePlayerType.MINE then
            if cryChangeMine.add[type]~=nil then
                cryChangeMine.add[type]=cryChangeMine.add[type]+count
            else
                cryChangeMine.add[type]=count
            end
        elseif   self.owner.playerType==BattleEnum.BattlePlayerType.ENEMY then
            if cryChangeEnemy.add[type]~=nil then
                cryChangeEnemy.add[type]=cryChangeEnemy.add[type]+count
            else
                cryChangeEnemy.add[type]=count
            end
        end
        self.owner.group.player.OneBattle.battleMessage:Broadcast(BattleEnum.BattleMessage.NOTIFYUICRYCHANGE,{cryChangeMine,cryChangeEnemy})
        self.owner.group.player:OpreateCrytals(serverRelease.crytal.type,serverRelease.crytal.count)
        if serverRelease.crytal.target > 0 then
            self.owner.group.player.OneBattle.battleMessage:Broadcast(BattleEnum.BattleMessage.NOTIFYPLAYERDROPCRY,serverRelease.crytal.targetTeam,serverRelease.crytal.target,type,count)
        end
    elseif serverRelease.typeId==4 then--添加BUFF

    elseif serverRelease.typeId==5 then--吸血

    elseif serverRelease.typeId==6 then--额外伤害

    end
end


local function OnInit(self,owner,serverEffect,param2,param3)
    self.owner=owner
    self.effectId=serverEffect.effectId
    self.layer=serverEffect.layer
    self.lastTime=serverEffect.lastTime
    if not serverEffect.release._is_null then
        --self.release=serverEffect.release
        ReleaseHandler(self,serverEffect.release,param2,param3)
    end
    self.value = serverEffect.value
    self.maxValue = serverEffect.maxValue
    self.isRemove=serverEffect.isRemove
    self.owner.group.player.OneBattle.battleMessage:Broadcast(BattleEnum.BattleMessage.SOMEEFFECT_INIT,self.owner,self)
end

local function SyncByServer(self,serverEffect,param2,param3)
    self.effectId=serverEffect.effectId
    self.layer=serverEffect.layer
    self.lastTime=serverEffect.lastTime
    if not serverEffect.release._is_null then
        --self.release=serverEffect.release
        ReleaseHandler(self,serverEffect.release,param2,param3)
    end
    self.value = serverEffect.value
    self.maxValue = serverEffect.maxValue
    self.isRemove=serverEffect.isRemove
    self.owner.group.player.OneBattle.battleMessage:Broadcast(BattleEnum.BattleMessage.SOMEEFFECT_SYNC,self.owner,self)
end

local function OnDestroy(self)
    self.owner.group.player.OneBattle.battleMessage:Broadcast(BattleEnum.BattleMessage.SOMEEFFECT_DESTROY,self.owner,self)
end

BattleSkillEffect.__init=__init
BattleSkillEffect.OnInit=OnInit
BattleSkillEffect.OnDestroy=OnDestroy
BattleSkillEffect.SyncByServer=SyncByServer
return BattleSkillEffect