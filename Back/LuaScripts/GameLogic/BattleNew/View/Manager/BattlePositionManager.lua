---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guoyu.
--- DateTime: 2018/12/21 14:07
---
local BattleAssistFunction= require "GameLogic.BattleNew.BattleAssistFunction"
local BattleFieldManager=require "GameLogic.BattleNew.Logic.Manager.BattleFieldManager"
local BattlePositionManager=BaseClass("BattlePositionManager")

local function __init(self)
    --战斗站位点
    self.transFroms={}
    --战场挂点
    self.fieldNodes={}
end

local function OnInit(self)
    local areaObject=CS.UnityEngine.GameObject.Find("BattleArea")
    for i=1,2 do
        self.transFroms[i]={}
        local gameObject=CS.UnityEngine.GameObject()
        gameObject.name="BattlePlayer"..i
        self.transFroms[i].transform=gameObject.transform
        self.transFroms[i].transform:SetParent(areaObject.transform,false)
        for j=1,3 do
            self.transFroms[i][j]={}
            local gameObject= CS.UnityEngine.GameObject()
            gameObject.name="battleGroup"..j
            self.transFroms[i][j].transform=gameObject.transform
            self.transFroms[i][j].transform:SetParent(self.transFroms[i].transform,false)
            for z=1,2 do
                self.transFroms[i][j][z]={}
                local gameObject=CS.UnityEngine.GameObject()
                gameObject.name="pos"..z
                gameObject.transform:SetParent(self.transFroms[i][j].transform,false)
                if z==1 then
                    gameObject.transform.transform.localPosition=BattleAssistFunction.GetRolePosition(BattleFieldManager:GetInstance().sceneConfigId,i,j)
                    gameObject.transform.transform.localEulerAngles=BattleAssistFunction.GetRoleEulerAngle(BattleFieldManager:GetInstance().sceneConfigId,i,j)
                elseif z==2 then--后排隐藏
                    gameObject.transform.transform.localPosition=BattleAssistFunction.GetSummonPosition(BattleFieldManager:GetInstance().sceneConfigId,i,j)
                    gameObject.transform.transform.localEulerAngles=BattleAssistFunction.GetSummonEulerAngle(BattleFieldManager:GetInstance().sceneConfigId,i,j)
                end


                local roleAnchro = CS.UnityEngine.GameObject()
                roleAnchro.name = "roleAnchro"
                roleAnchro.transform:SetParent(gameObject.transform)
                roleAnchro.transform.localPosition = Vector3.zero
                roleAnchro.transform.localEulerAngles = Vector3.zero

                self.transFroms[i][j][z].transform=roleAnchro.transform

            end
        end
    end
    --战场挂点
    --双方阵容中心点
    local gameObject=CS.UnityEngine.GameObject()
    gameObject.name="BattleFieldNodes"
    self.fieldNodes.gameObject = gameObject
    local pos1=self.transFroms[1][1][1].transform.position
    local pos2=self.transFroms[2][1][1].transform.position
    local center=CS.UnityEngine.GameObject()
    center.name="center"
    center.transform:SetParent(gameObject.transform,false)
    center.transform.position=Vector3.New((pos1.x+pos2.x)/2,0,(pos1.z+pos2.z)/2)
    self.fieldNodes["Center"]=center.transform

    local player1Center=CS.UnityEngine.GameObject()
    player1Center.name="player1Center"
    player1Center.transform:SetParent(gameObject.transform,false)
    player1Center.transform.position=pos1
    self.fieldNodes["player1Center"]=player1Center.transform

    local player2Center=CS.UnityEngine.GameObject()
    player2Center.name="player2Center"
    player2Center.transform:SetParent(gameObject.transform,false)
    player2Center.transform.position=pos2
    self.fieldNodes["player2Center"]=player2Center.transform
end


local function GetTransFormById(self,playerId,GroupId,PositionId)
    --Logger.Log("获取角色站位夫节点".."playerId"..playerId.."GroupId"..GroupId.."PositionId"..PositionId)
    return self.transFroms[playerId][GroupId][PositionId].transform
end

local function GetFieldNodesByPlayerType(self,playerType)
    local fieldNodes={}
    if playerType==BattleEnum.BattlePlayerType.MINE then
        fieldNodes[1]= self.fieldNodes["Center"].gameObject
        fieldNodes[2]= self.fieldNodes["player1Center"].gameObject
        fieldNodes[3]= self.fieldNodes["player2Center"].gameObject
    elseif playerType==BattleEnum.BattlePlayerType.ENEMY then
        fieldNodes[1]= self.fieldNodes["Center"].gameObject
        fieldNodes[2]= self.fieldNodes["player2Center"].gameObject
        fieldNodes[3]= self.fieldNodes["player1Center"].gameObject
    end
    return fieldNodes
end

local function OnDestroy(self)
    --for k,v in pairs(self.transFroms) do
    --    CS.UnityEngine.GameObject.Destroy(v.transform.gameObject)
    --end
    if self.transFroms ~= nil then
        for i = 1, 2 do
            if self.transFroms[i] ~= nil and not IsNull(self.transFroms[i].transform) then
                CS.UnityEngine.GameObject.Destroy(self.transFroms[i].transform.gameObject)
            end
        end
        self.transFroms=nil
    end
    if self.fieldNodes ~= nil and not IsNull(self.fieldNodes.gameObject) then
        CS.UnityEngine.GameObject.Destroy(self.fieldNodes.gameObject)
        self.transFroms=nil
    end
end

BattlePositionManager.__init=__init
BattlePositionManager.OnInit=OnInit
BattlePositionManager.OnDestroy=OnDestroy
BattlePositionManager.GetTransFormById=GetTransFormById
BattlePositionManager.GetFieldNodesByPlayerType=GetFieldNodesByPlayerType
return BattlePositionManager