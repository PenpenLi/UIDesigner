---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by ljl.
--- DateTime: 2018/11/30 11:14
---
--[[
-- 视图层
-- 注意：
-- 1、成员变量最好预先在OnCreate函数声明，提高代码可读性
-- 2、OnEnable函数每次在窗口打开时调用，直接刷新
-- 3、组件命名参考代码规范
--]]

local UINoticeView = BaseClass("UINoticeView", UIBaseView)
local base = UIBaseView
local UINoticeWrapItem = require "UI.UINotice.Component.UINoticeWrapItem"

local close_btn_path="BgRoot/Close_UIButton"
local know_btn_path="BgRoot/KnowBtn"
--TODO:此组按钮暂时取消
-- local active_btn_path = "BgRoot/Active_UIButton"
-- local notice_btn_path = "BgRoot/Notice_UIButton"
-- local select_obj_path = "BgRoot/SelectImg"
-- local select_text_path = "BgRoot/SelectImg/select_UIText"
-- local active_text_path = "BgRoot/Active_UIButton/Active_UIText"
-- local notice_text_path = "BgRoot/Notice_UIButton/Notice_UIText"
-- local title_text_path = "BgRoot/title_UIText"

local title_text_path = "BgRoot/TipInstruct"
local info_text_path = "BgRoot/ScrollRect/info_UIText"


local function OnCreate(self)
    base.OnCreate(self)
    -- 初始化各个组件
    self.close_btn=self:AddComponent(UIButton, close_btn_path)
    self.know_btn=self:AddComponent(UIButton, know_btn_path)
    self.close_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.know_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    --获取公告数据
    -- self.active_btn=self:AddComponent(UIButton, active_btn_path)
    -- self.active_btn:SetOnClick(function()
    --     self.SetBtnParent(self,self.select_obj,self.active_btn.transform)
    --     self.select_text:SetText(DataUtil.GetClientText(100004))
        -- self.data_list = self.model.active_noticeList
        -- self:SetData()
    -- end)
    -- self.notice_btn = self:AddComponent(UIButton,notice_btn_path)
    -- self.notice_btn:SetOnClick(function ()
    --     self.SetBtnParent(self,self.select_obj,self.notice_btn.transform)
    --     self.select_text:SetText(DataUtil.GetClientText(100005))
        -- self.data_list = self.model.note_noticeList
        -- self:SetData()
    -- end)
    -- self.select_obj =  UIUtil.FindTrans(self.transform,select_obj_path)
    -- self.select_text = self:AddComponent(UIText, select_text_path)
    -- self.active_text = self:AddComponent(UIText, active_text_path)
    -- self.notice_text = self:AddComponent(UIText, notice_text_path)
    self.title_text = self:AddComponent(UIText, title_text_path)
    self.info_text = self:AddComponent(UIText, info_text_path)
    self.award_grid = self:AddComponent(UIWrapGroup3D,"UIScrollRect/ScrollRect/Grid",UINoticeWrapItem)
end

local function SetData(self)
    if self.data_list ~= nil and #self.data_list> 0 then
        self.award_grid:SetLength(table.count(self.data_list))
        self.award_grid:SetGridPositionByIndex(0)
    else
        self.award_grid:SetLength(0)
    end
    self:SetContData(self.data_list[1])
    
end

--设置显示单个技能的选择
-- local function SetBtnParent(self,child,parent)
--     child.transform:SetParent(parent)
--     child.localScale=Vector3.New(1,1,1)
--     child.anchoredPosition=Vector2.New(0,0)
--     child.gameObject:SetActive(true)
-- end

local function OnEnable(self)
    base.OnEnable(self)
    self:OnRefresh()
    -- self.SetBtnParent(self,self.select_obj,self.active_btn.transform)
    -- self.select_text:SetText(DataUtil.GetClientText(100004))
    self.data_list = self.model.active_noticeList
    self:SetData()
end

local function SetContData(self,_data)
    self.info_text.rectTransform.anchoredPosition= Vector3.New(0,0,0)
    self.title_text:SetText(_data.name) 
    _data.content = string.gsub(_data.content,"\\n", "\n")
    _data.content = string.gsub(_data.content,"\\r", "\r")
    self.info_text:SetText(_data.content)
end

local function OnRefresh(self)
    -- 各组件刷新
end

local function OnAddListener(self)
    base.OnAddListener(self)
    -- UI消息注册

end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
    -- UI消息注销

end

local function OnDestroy(self)
    -- 销毁
    base.OnDestroy(self)
end

UINoticeView.OnCreate = OnCreate
UINoticeView.OnEnable = OnEnable
UINoticeView.OnRefresh = OnRefresh
UINoticeView.OnAddListener = OnAddListener
UINoticeView.OnRemoveListener = OnRemoveListener
UINoticeView.OnDestroy = OnDestroy
UINoticeView.SetContData = SetContData
-- UINoticeView.SetBtnParent = SetBtnParent
UINoticeView.SetData = SetData

return UINoticeView
