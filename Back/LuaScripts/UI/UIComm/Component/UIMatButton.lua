---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by aaa.
--- DateTime: 2019/5/6 14:45
---
local UIMatButton = BaseClass("UIMatButton", UIBaseContainer)
local base = UIBaseContainer
local staticItemData=DataUtil.GetData("item")

local function OnClick(self)
    LJAudioManger:GetInstance():PlayVoice("UI_CommonClick")
    if self.can_click then
        if self.currency_meet  then
            if self.call_back ~= nil then
                self.call_back()
            end
        else
            UISpecial:GetInstance():UITipText(DataUtil.GetClientText(100060))
        end
    else
        if self.gray_call then
            self.gray_call()
        end
        if GuideGroup:GetInstance().Runing then
            GuideManager:GetInstance():SetGuideRecode(GuideGroup:GetInstance().CurType)
            GuideGroup:GetInstance():GuideOverCheck()
        end
    end
end
-- 创建
local function OnCreate(self)
    base.OnCreate(self)
    self.click_btn = self:AddComponent(UIButton,"")
    self.click_btn:SetOnClick(self,OnClick)
    self.gray_img = self:AddComponent(UIImage,"")
    self.gray_mat = self.gray_img:GetMat()
    self.tip_text = self:AddComponent(UIText,"tip")
    self.name_text = self:AddComponent(UIText,"name")
    self.outline=self:AddComponent(UIOutlineEx,"name")
    self.costObj=UIUtil.FindTrans(self.transform,"costparent")
    self.cost_text = self:AddComponent(UIText,"costparent/costNum")
    self.cost_icon = self:AddComponent(UIImage,"costparent/costIcon",AtlasConfig.DynamicTex)
    self.eff=UIUtil.FindTrans(self.transform,"name/fx_ui_commonbutton_sweeplight")
end
--更新按钮状态  0-条件不满足  1-条件满足
local function UpdateButtonState(self,state,msg)

    if state == 1then
        self.can_click = true
        --self.click_btn:SetInteractable(true)
        self.gray_img:SetMat(nil)
        self.tip_text.gameObject:SetActive(false)
        self.name_text:SetColor32(239,234,222,255)
        self.outline:SetColor32(5,5,5,255)
        if self.eff then
            self.eff.gameObject:SetActive(true);
        end
    else
        self.can_click = false
        --self.click_btn:SetInteractable(false)
        self.gray_img:SetMat(self.gray_mat)
        self.tip_text.gameObject:SetActive(true)
        if msg then
            self.tip_text:SetText(msg)
        else
            self.tip_text:SetText("材料不足")
        end

        self.name_text:SetColor32(21,24,30,255)
        self.outline:SetColor32(84,83,83,255)
        if self.eff then
            self.eff.gameObject:SetActive(false);
        end
    end
end

local function UpdateCurrency(self,des)
    if self.itemId ~= nil then
        self.tip_text.gameObject:SetActive(false)
        if BackpackData:GetInstance():GetItemNumById(self.itemId) >= self.needNum then
            self.cost_text:SetColor32(255,255,255,255)
            self.currency_meet = true
            self:UpdateButtonState(1)
        else
            self.cost_text:SetColor32(223,76,76,255)
            self.currency_meet = false
            self:UpdateButtonState(0,des)
        end
    end
end

local function OnInitBtn(self,btnText,callBack,itemId,needNum,des,gray_call)
    self.name_text:SetText(btnText)
    self.call_back = callBack
    self.gray_call=gray_call
    if itemId ~= nil and needNum ~= nil then
        self.costObj.gameObject:SetActive(true)
        self.itemId = itemId
        self.needNum = needNum
        self.cost_text:SetText(DataUtil.GetDataNumDes(needNum))
        if staticItemData[itemId]==nil then
            Logger.LogError("itemId   Item  没有这个ID"..itemId)
        end
        self.cost_icon:SetSpriteName(staticItemData[itemId].Icon)
        if des then
            self.tip_text:SetText(des)
        end
    else
        self:UpdateButtonState(1)
        self.currency_meet=true
        self.costObj.gameObject:SetActive(false)
    end
end
UIMatButton.OnInitBtn = OnInitBtn
UIMatButton.UpdateCurrency = UpdateCurrency
UIMatButton.UpdateButtonState = UpdateButtonState
UIMatButton.OnCreate = OnCreate
return UIMatButton