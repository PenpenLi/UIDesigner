---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by ljl.
--- DateTime: 2019/5/7 15:59
---
local UIWeaponLvInfoItem=BaseClass("UIWeaponLvInfoItem",UIWrapComponent)
local base = UIWrapComponent
local propertyList=DataUtil.GetData("property")

local function OnCreate(self,_data)
    base.OnCreate(self)
    --组建初始化
    self.nameText = self:AddComponent(UIText, "name")
    self.beforeText = self:AddComponent(UIText,"beforeText")
    self.afterText = self:AddComponent(UIText,"afterText")
    self.AniObj=UIUtil.FindTrans(self.transform,"green arrow");
    self.obj = UIUtil.FindTrans(self.transform,"Image")
    self.Ani=self.AniObj:GetComponent(typeof(CS.UnityEngine.Animator))
    self.data = _data
end

-- 组件被复用时回调该函数，执行组件的刷新
local function OnRefresh(self,real_index)
    if self.data.btn_type==2 then
        if real_index == 0 then
            self.proper_id=111
        elseif real_index==1 then
            self.proper_id=112
        elseif real_index==2 then
            self.proper_id=113
        end
        self.nextData= Mathf.Floor( self.data.weapon_part.nextStrengthProperty[self.proper_id])
        self.curData= Mathf.Floor(self.data.weaponData.strength_property[self.proper_id])
        self.nameText:SetText(propertyList[self.proper_id].CnName)
        local des= self.data.weapon_part.level<self.data.weapon_part.maxLevel and (self.nextData+self.curData).."(+"..self.nextData..")" or "已满"
        self.afterText:SetText(des)
        self.beforeText:SetText(self.curData)

        if not self.data.canbtn then
            self.Ani:Play("FX_ui_c_green arrow")
        end
        self.obj.gameObject:SetActive(real_index%2 == 0)
    end
end
local function SetData(self,nextdata,_isMax)
    self.nameText:SetText(nextdata.name)
    --获得属性
    local num=CardData:GetInstance():GetCardSingleWeaponmProperty(self.data.cardId,nextdata.id)
    if propertyList[nextdata.id].Show_Fac==100 then
        self.beforeText:SetText( math.floor(num*100).."%")
        self.afterText:SetText(math.floor((num+nextdata.real_value)*100).."%")
    else
        self.beforeText:SetText(math.floor(num) )
        self.afterText:SetText(math.floor(num)+math.floor(nextdata.real_value))
    end
    if _isMax then
        self.afterText:SetText("已满")
    end
end
UIWeaponLvInfoItem.OnCreate = OnCreate
UIWeaponLvInfoItem.OnRefresh=OnRefresh
UIWeaponLvInfoItem.SetData = SetData

return UIWeaponLvInfoItem