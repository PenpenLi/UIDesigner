---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by ljl.
--- DateTime: 2019/7/12 11:16
---

local UICardGLZhuanJi=BaseClass("UICardGLZhuanJi", UIBaseContainer)
local base = UIBaseContainer
local card_datas=DataUtil.GetData("card")
local UICardGLZhuanJIItem = require "UI.UICardList.Component.card_gonglue.UICardGLZhuanJIItem"

local function OnCreate(self,_holderSelf)
    base.OnCreate(self)
    --定位关键词
    --_holderSelf.selectItemData
    self.data = _holderSelf.selectItemData
    if self.data == nil then
        Logger.LogError("select role is nil")
        return
    end
    self.data_holderSelf = _holderSelf
   -- self.id = self.data.id

    self.box_group=self:AddComponent(UIBaseContainer,"skillbg/grid");
    local boxCount=self.box_group.transform.childCount;
    self.boxPrbList={};
    for i = 0, boxCount-1 do
        local singleBoxTrans=self.box_group.transform:GetChild(i);
        local passBox=UICardGLZhuanJIItem.New(self,singleBoxTrans.gameObject);
        passBox:OnCreate();
        table.insert(self.boxPrbList,passBox);
    end

    self:OnRefresh()

end



--刷新
local function OnRefresh(self)
    self.dataItem = card_datas[self.data_holderSelf.selectItemData.id]
    self.Episode = self.dataItem.Episode
    for i, v in ipairs(self.boxPrbList) do
        v.transform.gameObject:SetActive(self.Episode[i] ~= nil)
        if self.Episode[i] ~= nil then
            v:OnRefresh(self.Episode[i])
        end
    end
end


local function OnDestroy(self)
    base.OnDestroy(self)
end
local function OnDisable(self)

end
local function OnSelectCard(self, _type, cardid)
    self.id = cardid
    self:OnRefresh()
end
local function OnAddListener(self)
    base.OnAddListener(self)
    -- UI消息注册
    self:AddUIListener(UIMessageNames.UI_CARD_POOL_ON_SELECT_CARD, OnSelectCard)
    --self:AddUIListener(UIMessageNames.UI_NEWCARD_CHANGE_TYPE, SetNewModule)
    --self:AddUIListener(UIMessageNames.UI_NEWCARD_BREAK_SUCCESS, RefreshUISon)
    --self:AddUIListener(UIMessageNames.UI_NEWCARD_SKILL_UPDATE, UpdateSkillFun)

end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
    -- UI消息注销
    self:RemoveUIListener(UIMessageNames.UI_CARD_POOL_ON_SELECT_CARD, OnSelectCard)
    --self:RemoveUIListener(UIMessageNames.UI_NEWCARD_CHANGE_TYPE, SetNewModule)
    --self:RemoveUIListener(UIMessageNames.UI_NEWCARD_BREAK_SUCCESS, RefreshUISon)
    --self:RemoveUIListener(UIMessageNames.UI_NEWCARD_SKILL_UPDATE, UpdateSkillFun)
end
UICardGLZhuanJi.OnDestroy= OnDestroy
UICardGLZhuanJi.OnDisable=OnDisable
UICardGLZhuanJi.OnCreate=OnCreate
UICardGLZhuanJi.OnRefresh=OnRefresh
UICardGLZhuanJi.OnRemoveListener=OnRemoveListener
UICardGLZhuanJi.OnAddListener=OnAddListener
UICardGLZhuanJi.OnSelectCard=OnSelectCard
return UICardGLZhuanJi