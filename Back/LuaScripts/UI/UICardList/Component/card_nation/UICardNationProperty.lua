---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by aaa.
--- DateTime: 2019/5/6 11:35
---
local UICardNationProperty = BaseClass("UICardNationProperty", UIBaseContainer)
local base = UIBaseContainer

local UICardNationBasProItem = require "UI.UICardList.Component.card_nation.UICardNationBasProItem"
local UICardNationTalentItem = require "UI.UICardList.Component.card_nation.UICardNationTalentItem"

local function OnCreate(self, parent)
    base.OnCreate(self)

    self.parent = parent

    self.propertyBtnText = self:AddComponent(UIText, "propertyBtn/propertyBtnText")
    self.propertyBtnText:SetText(DataUtil.GetClientText(200295))

    --兵力属性
    self.propertyTab = {}
    for i = 1, 3 do
        self.propertyTab[i] = {}
        self.propertyTab[i].name = self:AddComponent(UIText, "TopContent/Item" .. i .. "/Name" .. i)
        self.propertyTab[i].value = self:AddComponent(UIText, "TopContent/Item" .. i .. "/Value" .. i)
        self.propertyTab[i].slider = self:AddComponent(UISlider, "TopContent/Item" .. i .. "/Slider" .. i)
    end

    --基础属性
    self.centerTitleText = self:AddComponent(UIText, "CenterContent/CenterTitle")
    self.centerTitleText:SetText(DataUtil.GetClientText(200296))
    self.basicPropertyWrap = self:AddComponent(UIWrapGroup3D, "CenterContent/ScrollView/basicGrid", UICardNationBasProItem)

    --国战天赋
    self.talentTitleText = self:AddComponent(UIText, "BottomContent/talentTitle")
    self.talentTitleText:SetText(DataUtil.GetClientText(200297))
    self.talentGridRect = UIUtil.FindComponent(self.transform, typeof(CS.UnityEngine.RectTransform), "BottomContent/ScrollView/talentGrid")
    self.talentGridObj = UIUtil.FindTrans(self.transform, "BottomContent/ScrollView/talentGrid").gameObject
    self.talentList = {}
    for i = 1, 3 do
        self.talentList[i] = UICardNationTalentItem.New(self, "BottomContent/ScrollView/talentGrid/Item" .. i)
        self.talentList[i]:OnCreate()
    end
end

local function OnRefresh(self)
    local cardData = self.view.model.curSelectCardNationData

    self.talentGridRect.anchoredPosition3D = Vector3.New(0, 0, 0)

    local temp = nil
    for i = 1, 3 do
        temp = cardData.property[i]
        self.propertyTab[i].name:SetText(temp.name)
        self.propertyTab[i].value:SetText(temp.value)
        self.propertyTab[i].slider:SetValue(temp.sliderValue)
    end

    if #cardData.basic > 0 then
        self.basicPropertyWrap:SetLength(#cardData.basic)
        self.basicPropertyWrap:SetGridPositionByIndex(0)
    else
        self.basicPropertyWrap:SetLength(0)
    end

    for k, v in ipairs(self.view.model.curSelectCardNationData.talent) do
        if v.isLock then
            self.talentList[k].rectTransform.sizeDelta = Vector2.New(self.talentList[k].rectTransform.sizeDelta.x, 125)
        else
            self.talentList[k].rectTransform.sizeDelta = Vector2.New(self.talentList[k].rectTransform.sizeDelta.x, 420)
        end
        self.talentList[k]:OnRefresh(v)
    end
end

local function OnDisable(self)

end

local function OnDestroy(self)
    --主界面DesTory 触发

end

UICardNationProperty.OnCreate = OnCreate
UICardNationProperty.OnRefresh = OnRefresh
UICardNationProperty.OnDestroy = OnDestroy
UICardNationProperty.OnDisable = OnDisable
return UICardNationProperty