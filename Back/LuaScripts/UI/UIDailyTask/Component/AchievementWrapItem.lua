---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by ljl.
--- DateTime: 2019/2/27 19:29
---
local AchievementWrapItem=BaseClass("AchievementWrapItem",UIWrapComponent)
local base = UIWrapComponent
local TaskAwardItem = require "UI.UIDailyTask.Component.TaskAwardItem"

local function OnCreate(self)
    base.OnCreate(self)
    --组建初始化
    self.comeBtn = self:AddComponent(UIButton,"getButton")
    self.comeBtn:SetOnClick(function ()
        LJAudioManger:GetInstance():PlayVoice("UI_CommonClick")
        self.view:GetAchievementTaskAward(self.achievement_data.id)
        self.comeBtn.gameObject:SetActive(false)
        self.slider.gameObject:SetActive(false)
        self.has_get_img.gameObject:SetActive(true)
    end)
    self.name_text = self:AddComponent(UIText, "titleText")
    self.des_text = self:AddComponent(UIText,"desText")
    self.slider = self:AddComponent(UISlider, "scrollbar")
    self.mission_slider_text = self:AddComponent(UIText,"scrollbar/scoreText")
    self.has_get_img = UIUtil.FindTrans(self.transform,"hasgetimg")
    self.grid = self:AddComponent(UIBaseContainer,"grid")
    local itemCount = self.grid.transform.childCount
    self.awardPrbList = {}
    for i = 0, itemCount - 1 do
        local singleTrans = self.grid.transform:GetChild(i)
        local pass = TaskAwardItem.New(self,singleTrans.gameObject)
        pass:OnCreate()
        table.insert(self.awardPrbList,pass)
    end
end

-- 组件被复用时回调该函数，执行组件的刷新
local function OnRefresh(self,real_index)
    if self.view.achievement_data == nil then
        return
    end
    local data=self.view.achievement_data[real_index+1]
    self.achievement_data = data
    if data==nil then
        return
    end
    self.name_text:SetText(data.name)
    self.des_text:SetText(data.des)
    self.mission_slider_text:SetText(math.floor(data.now_progress).."/"..data.all_progress)
    if data.status == 0 then
        self.comeBtn.gameObject:SetActive(false)
        self.slider.gameObject:SetActive(true)
        self.has_get_img.gameObject:SetActive(false)
        self.slider:SetValue(data.now_progress/data.all_progress)
    elseif data.status == 1 then
        self.comeBtn.gameObject:SetActive(false)
        self.slider.gameObject:SetActive(false)
        self.has_get_img.gameObject:SetActive(true)
    else
        self.comeBtn.gameObject:SetActive(true)
        self.slider.gameObject:SetActive(false)
        self.has_get_img.gameObject:SetActive(false)
    end
    self.awardList = data.reward
    for i, v in ipairs(self.awardPrbList) do
        if self.awardList[i]~=nil then
            v.gameObject:SetActive(true)
            v:Refresh(self.awardList[i])
        else
            v.gameObject:SetActive(false)
        end
    end
end

AchievementWrapItem.OnCreate = OnCreate
AchievementWrapItem.OnRefresh=OnRefresh

return AchievementWrapItem
