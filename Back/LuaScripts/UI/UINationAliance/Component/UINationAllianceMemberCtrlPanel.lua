---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guoyu.
--- DateTime: 2019/6/20 15:20
---
local UINationAllianceMemberCtrlPanel = BaseClass("UINationAllianceMemberPanel", UIBaseContainer)
local base = UIBaseContainer

local OperateItem = require "UI.UINationAliance.Component.UINationAllianceOperateWrapItem"

local EnumOperateType = {
    PositionManagement = 1, --职位管理
    KickOut = 2, --踢出联盟
    Quit = 3, --退出联盟
    Demise = 4, --禅让盟主
    GiveUpPos = 5, --放弃职位
}

local function OnCreate(self)
    base.OnCreate(self)

    self.maskButton = self:AddComponent(UIButton, "mask")
    self.maskButton:SetOnClick(function()
        self:SetActive(false)
    end)

    self.closeButton = self:AddComponent(UIButton, "Top/CloseButton")
    self.closeButton:SetOnClick(function()
        self:SetActive(false)
    end)

    self.titleText = self:AddComponent(UIText, "Top/Text")
    self.titleText:SetText(DataUtil.GetClientText(200273))

    self.operateItemWrapGroup = self:AddComponent(UIWrapGroup3D, "layout/content", OperateItem)
end

local function OnEnable(self)
    self:OnRefresh()
end

local function OnRefresh(self)
    self.buttonFuncList = {}
    local myUnionMember = self.view.model.myUnionMember

    local config = myUnionMember.positionData
    if config.Demise ~= nil and config.Demise == 1 then
        if self.view.model.isMine == false then
            --操作别人
            local item = {}
            item.text = DataUtil.GetClientText(200274)
            item.type = EnumOperateType.Demise
            table.insert(self.buttonFuncList, item)
        end
    end
    if config.AddPost ~= nil and config.AddPost == 1 then
        if self.view.model.isMine == false then
            --操作别人
            local item = {}
            item.text = DataUtil.GetClientText(200275)
            item.type = EnumOperateType.PositionManagement
            table.insert(self.buttonFuncList, item)
        end
    end
    if config.RemoveMember ~= nil and config.RemoveMember == 1 then
        if self.view.model.isMine == false then
            --操作别人
            local item = {}
            item.text = DataUtil.GetClientText(200276)
            item.type = EnumOperateType.KickOut
            table.insert(self.buttonFuncList, item)
        end
    end
    if config.GiveUpPost ~= nil and config.GiveUpPost == 1 then
        if self.view.model.isMine == true then
            --操作自己
            local item = {}
            item.text = DataUtil.GetClientText(200277)
            item.type = EnumOperateType.GiveUpPos
            table.insert(self.buttonFuncList, item)
        end
    end

    if config.Order == 1 then
        --盟主
        --if #self.view.model.members==1 then
        if self.view.model.isMine == true then
            --操作自己
            local item = {}
            item.text = DataUtil.GetClientText(200278)
            item.type = EnumOperateType.Quit
            table.insert(self.buttonFuncList, item)
        end
        --end
    else
        if config.Quit ~= nil and config.Quit == 1 then
            if self.view.model.isMine == true then
                --操作自己
                local item = {}
                item.text = DataUtil.GetClientText(200279)
                item.type = EnumOperateType.Quit
                table.insert(self.buttonFuncList, item)
            end
        end
    end

    if #self.buttonFuncList > 0 then
        self.operateItemWrapGroup:SetLength(#self.buttonFuncList)
        self.operateItemWrapGroup:SetGridPositionByIndex(0)
    else
        self.operateItemWrapGroup:SetLength(0)
    end
end

UINationAllianceMemberCtrlPanel.OnRefresh = OnRefresh
UINationAllianceMemberCtrlPanel.OnCreate = OnCreate
UINationAllianceMemberCtrlPanel.OnEnable = OnEnable

return UINationAllianceMemberCtrlPanel