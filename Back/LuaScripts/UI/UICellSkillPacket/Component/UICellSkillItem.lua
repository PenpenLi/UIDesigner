---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by ljl.
--- DateTime: 2019/6/3 19:55
---

local UICellSkillItem = BaseClass("UICellSkillItem",UIWrapComponent)
local base = UIWrapComponent
local static_data=DataUtil.GetData("card")
---点击单个物品
local function OnSkillItemClick(self)
    if self.skill_single_data==nil then
        return
    end
    LJAudioManger:GetInstance():PlayVoice("UI_CommonClick")
    self.view.SetRightPanelData(self.view, self.bg.transform,self.skill_single_data)
end

local function OnCreate(self)
    base.OnCreate(self)
    --组建初始化
    self.bg = self:AddComponent(UIImage,"bg/namebg")
    self.hun=self:AddComponent(UIImage,"bg/skillbg/cry",AtlasConfig.DynamicTex)
    self.hun_count = self:AddComponent(UIText,"bg/skillbg/cry/Text")
    self.skill_bg = self:AddComponent(UIImage,"bg/skillbg",AtlasConfig.DynamicTex)
    self.skill_icon_img =self:AddComponent(UIImage,"bg/skillbg/icon",AtlasConfig.DynamicTex)
    self.heroFrame = self:AddComponent(UIImage,"bg/heroFrame",AtlasConfig.DynamicTex)
    self.heroIcon = self:AddComponent(UIImage,"bg/heroFrame/heroIcon",AtlasConfig.DynamicTex)
    self.skill_btn = self:AddComponent(UIButton,"bg")
    self.skill_btn:SetOnClick(self,OnSkillItemClick)
    self.noObj = UIUtil.FindTrans(self.transform,"bg/No")
    self.noText = self:AddComponent(UIText,"bg/No/NoText")
    self.haveObj = UIUtil.FindTrans(self.transform,"bg/Have")
    self.haveText = self:AddComponent(UIText,"bg/Have/HaveText")
    self.isActivateObj = UIUtil.FindTrans(self.transform,"bg/Have/FX_ui_c_activateable")
    self.chip = self:AddComponent(UIImage,"bg/skillbg/chip",AtlasConfig.Language)
    self.name = self:AddComponent(UIText,"bg/naem")
    self.level = self:AddComponent(UIText,"bg/skillbg/lv")
    self.obj = UIUtil.FindTrans(self.transform,"bg")
    self.gray = self.skill_icon_img:GetMat()
    self.maskImg = self:AddComponent(UIImage, "bg/maskImg")
end

-- 组件被复用时回调该函数，执行组件的刷新
local function OnRefresh(self,real_index)
    self.skill_single_data=self.view.skillList[real_index+1]
    if  self.skill_single_data == nil then
        return
    end
    --self.obj.gameObject:SetActive(false)
    self.slect=UIUtil.FindTrans(self.transform,"bg/namebg/selectObj");
    if self.view.ClickID==self.skill_single_data.id   then
        if  self.slect~=nil then
            self.slect.gameObject:SetActive(true)
        else
            self.view.SetRightPanelData(self.view, self.bg.transform,self.skill_single_data)
        end

    else
        if  self.slect then
            self.slect.gameObject:SetActive(false)
        end
    end
    if self.skill_single_data == nil then
        return
    end

    self.name:SetText(self.skill_single_data.name)
    self.level:SetText(self.skill_single_data.levelInfo)
    self.skill_icon_img:SetSpriteName(self.skill_single_data.icon)
    self.hun_count:SetText(math.floor(self.skill_single_data.crystalCost))
    self.skill_bg:SetSpriteName(SpriteDefine:GetItemQualityFrameByType(self.skill_single_data.quality))
    if self.skill_single_data.crystalCost == 0 then
        self.hun_count.gameObject:SetActive(false)
        self.hun.gameObject:SetActive(false)
    else
        self.hun_count.gameObject:SetActive(true)
        self.hun.gameObject:SetActive(true)
    end
    if self.skill_single_data.showFireType == 1 or self.skill_single_data.showFireType == 4 then ---主動技能
        self.chip.gameObject:SetActive(false)
    elseif self.skill_single_data.showFireType == 2 then  --- 被動技能
        self.chip.gameObject:SetActive(true)
        self.chip:SetSpriteName("ui_dtex_Quality_039")
    elseif self.skill_single_data.showFireType == 3 then --- 連擊技能
        self.chip.gameObject:SetActive(true)
        self.chip:SetSpriteName("ui_dtex_Quality_040")
    end
    if self.skill_single_data.cardId==0 or self.skill_single_data.cardId == nil then
        self.heroFrame.gameObject:SetActive(false)
        self.noObj.gameObject:SetActive(true)
        self.noText:SetText("未装备")
        self.haveObj.gameObject:SetActive(false)
        self.hun:SetSpriteName("ui_dtex_Quality_041")
    else
        self.noObj.gameObject:SetActive(false)
        self.haveObj.gameObject:SetActive(true)
        self.haveText:SetText("已装备")
        self.isActivateObj.gameObject:SetActive(false)
        self.hun:SetSpriteName(SpriteDefine:GetCrystalIconByType(self.skill_single_data.skillCrystalIcon))
        self.heroFrame.gameObject:SetActive(true)
        local card_data= static_data[self.skill_single_data.cardId]
        self.heroFrame:SetSpriteName( SpriteDefine:GetItemQualityFrameByType(card_data.Quality))
        self.heroIcon:SetSpriteName(card_data.Icon)
    end
    self.maskImg.gameObject:SetActive(self.skill_single_data.isActivate == 1)
    if self.skill_single_data.isActivate == 1 then      --未激活
        self.heroIcon:SetMat(self.gray)
        self.skill_icon_img:SetMat(self.gray)
        self.noObj.gameObject:SetActive(true)
        self.noText:SetText("未激活")
        self.haveObj.gameObject:SetActive(false)
    elseif self.skill_single_data.isActivate == 2 then --已激活
        self.heroIcon:SetMat(nil)
        self.skill_icon_img:SetMat(nil)
    else                                                --可激活
        self.heroIcon:SetMat(self.gray)
        self.skill_icon_img:SetMat(self.gray)
        self.noObj.gameObject:SetActive(false)
        self.haveObj.gameObject:SetActive(true)
        self.haveText:SetText("可激活")
        self.isActivateObj.gameObject:SetActive(true)
    end
end

UICellSkillItem.OnCreate = OnCreate
UICellSkillItem.OnSkillItemClick = OnSkillItemClick
UICellSkillItem.OnRefresh=OnRefresh

return UICellSkillItem