---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzg
--- DateTime: 2019/2/25 16:34
---
local UICacodemonListWrapItem = BaseClass("UICacodemonListWrapItem", UIWrapComponent)
local base = UIWrapComponent
local skillData = DataUtil.GetData("skill")
local itemData = DataUtil.GetData("item")

-- 创建
local function OnCreate(self)
    base.OnCreate(self)
    -- 组件初始化
    self.Name_UIText=self:AddComponent(UIText,"Name_UIText")
    self.Des_UIText=self:AddComponent(UIText,"Des_UIText")
    self.titleBg = self:AddComponent(UIImage,"bgImage/Image")
    self.gray = self.titleBg:GetMat()
    self.HeadImage = self:AddComponent(UIImage,"HeadFrameImage/HeadImage",AtlasConfig.DynamicTex)
    self.skill_Img = self:AddComponent(UIImage,"SkillFrameImg/IconImage",AtlasConfig.DynamicTex)
    self.skillObj=UIUtil.FindTrans(self.transform,"SkillFrameImg");
    self.btn1Button = self:AddComponent(UIButton,"Stastus1/btn1Button")
    self.btn1Button:SetOnClick(function ()
        --todo 开战逻辑
        self.view:SendAttackRequest(self.infoId);
    end)
    --剩余次数
    self.StatusInfo_UIText = self:AddComponent(UIText,"Stastus1/StatusInfo_UIText")
    self.NameUIText = self:AddComponent(UIText,"Stastus2/NameUIText")
    --玩家在这个关卡上的状态
    self.StatusInfoUIText = self:AddComponent(UIText,"Stastus2/StatusInfoUIText")
    self.lvLimitText = self:AddComponent(UIText,"Stastus3/Status3Info_UIText")
    self.iconImg = self:AddComponent(UIImage,"Stastus2/Header",AtlasConfig.DynamicTex)
    self.frameImg = self:AddComponent(UIImage,"Stastus2/BgImage",AtlasConfig.DynamicTex)
    --可以打
    self.Statue1 = UIUtil.FindTrans(self.transform,"Stastus1")
    --有玩家在打
    self.Statue2 = UIUtil.FindTrans(self.transform,"Stastus2")

    self.Statue3 = UIUtil.FindTrans(self.transform,"Stastus3")

    self.info_iconPress = self:AddComponent(UIEventTrigger,"SkillFrameImg/IconImage")
    self.info_iconPress:SetOnLongPress(function()
        if self.Info.SkillId then
            UIManager:GetInstance():OpenWindow(UIWindowNames.UISkillTips,self.Info.SkillId)
        end
    end,(function()
        UIManager:GetInstance():CloseWindow(UIWindowNames.UISkillTips)
    end),true)
end

-- 组件被复用时回调该函数，执行组件的刷新
local function OnRefresh(self, real_index)
    self.index = real_index + 1

    self.Info = self.view.model:GetCurSelctList()[self.index]


     if self.Info ~= nil then
        self.Name_UIText:SetText(self.Info.Name)
        self.HeadImage:SetSpriteName(self.Info.Pic)
        self.skill_Img:SetSpriteName(skillData[self.Info.SkillId].Icon)
        self.Des_UIText:SetText(self.Info.Des)
        self.lvLimitText:SetText(self.Info.TeamDes)

        if self.Info.State == 0 then --恶灵状态 0：未战斗 1：正在战斗 2：已被击退
            self.StatusInfo_UIText:SetText(CacodemonData:GetInstance().lable2_UIText)
            if self.Info.Lock then
                self.Statue3.gameObject:SetActive(true)
                self.Statue2.gameObject:SetActive(false)
                self.Statue1.gameObject:SetActive(false)
                self.titleBg:SetMat(self.gray)
                self.HeadImage:SetMat(self.gray)
                self.skill_Img:SetMat(self.gray)
            else
                self.Statue1.gameObject:SetActive(true)
                self.Statue2.gameObject:SetActive(false)
                self.Statue3.gameObject:SetActive(false)
                self.titleBg:SetMat(nil)
                self.HeadImage:SetMat(nil)
                self.skill_Img:SetMat(nil)
            end
        else
            if self.Info.State == 1 then
                self.StatusInfoUIText:SetText("<color=#3F793F>正在战斗</color>")
            else
                self.StatusInfoUIText:SetText("<color=#DF4C4C>成功击退</color>")
            end
            self.iconImg:SetSpriteName(itemData[self.Info.IconId].Icon)
            self.frameImg:SetSpriteName(SpriteDefine:GetItemQualityFrameByType(itemData[self.Info.IconId].Quality))
            self.NameUIText:SetText(self.Info.PlayerName)
            self.Statue1.gameObject:SetActive(false)
            self.Statue2.gameObject:SetActive(true)
            self.Statue3.gameObject:SetActive(false)
        end
         self.infoId=self.Info.Id;
    else
        Logger.Log(self.index.."数据错误")
    end
    self.skillObj.transform.gameObject:SetActive(false);
    self.StatusInfo_UIText.transform.gameObject:SetActive(false);
end

UICacodemonListWrapItem.OnCreate = OnCreate
UICacodemonListWrapItem.OnRefresh = OnRefresh



return UICacodemonListWrapItem