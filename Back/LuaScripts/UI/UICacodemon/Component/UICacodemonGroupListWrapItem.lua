---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzg
--- DateTime: 2019/2/25 16:34
---
local UICacodemonGroupListWrapItem = BaseClass("UICacodemonGroupListWrapItem", UIWrapComponent)
local base = UIWrapComponent
local lock = false

-- 组件添加了按钮组，则按钮被点击时回调该函数
local function OnBtnClick(self)
    local playerLv = math.floor(UserData:GetInstance().pLevel)
    if playerLv < self.data.TeamLimitLv then
        UISpecial:GetInstance():UITipText("玩家等级不足")
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIItemJumpTip,1401014)
        return
    end
    LJAudioManger:GetInstance():PlayVoice("UI_CommonClick")
    UIManager:GetInstance():Broadcast(UIMessageNames.UI_CACODEMON_SELECT_GROUP,self.index)
end
-- 创建
local function OnCreate(self)
    base.OnCreate(self)
    -- 组件初始化
    self.Name_UIText=self:AddComponent(UIText,"Name_UIText")
    self.info1_UIText=self:AddComponent(UIText,"info1_UIText")
    self.info2_UIText=self:AddComponent(UIText,"info2_UIText")
    self.info3_UIText=self:AddComponent(UIText,"info3_UIText")
    self.imgBg = self:AddComponent(UIImage,"Image",AtlasConfig.DynamicTex)
    self.bgImg = self:AddComponent(UIImage,"bgImg",AtlasConfig.DynamicTex)
    self.btn=self:AddComponent(UIButton,"")
    self.gray = self.imgBg:GetMat()
    self.btn:SetOnClick(self,OnBtnClick)
    self.reddObj = UIUtil.FindTrans(self.transform,"Image (3)")
end

-- 组件被复用时回调该函数，执行组件的刷新
local function OnRefresh(self, real_index)
    self.index = real_index+1
    self.data = self.view.model:GetGroupList()[self.index]
    if self.data ~= nil then
        self.Name_UIText:SetText(self.data.Name)
        self.info1_UIText:SetText("恶灵剩余:"..self.data.CanNum.."/"..self.data.AllCanNum)
        self.bgImg:SetSpriteName(self.data.BgPic)
        local curTime  = math.floor( self.data.ResidueTime/1000)
        local formatTime = os.date("%H:%M",curTime)
        self.info2_UIText:SetText( formatTime.."再次来袭")
        local playerLv = math.floor(UserData:GetInstance().pLevel)
        if playerLv >= self.data.TeamLimitLv then
            lock = false
            self.info3_UIText:SetText("参战条件:队伍等级<color=#EBE9DA>"..self.data.TeamLimitLv.."级</color>")
        else
            lock = true
            self.info3_UIText:SetText("参战条件:队伍等级<color=#DF4C4C>"..self.data.TeamLimitLv.."级</color>")
        end
        if lock then
            self.imgBg:SetMat(self.gray)
            self.bgImg:SetMat(self.gray)
            self.reddObj.gameObject:SetActive(false)
        else
            if self.index == self.view.model.curSelectGroupIndex then
                self.imgBg:SetSpriteName("ui_t_c2_071")
            else
                self.imgBg:SetSpriteName("ui_t_c2_066")
            end
            self.reddObj.gameObject:SetActive(CacodemonData:GetInstance().earningsTimes > 0)
            self.imgBg:SetMat(nil)
            self.bgImg:SetMat(nil)
        end
    else
        Logger.Log(self.index.."数据错误")
    end

end

UICacodemonGroupListWrapItem.OnCreate = OnCreate
UICacodemonGroupListWrapItem.OnRefresh = OnRefresh



return UICacodemonGroupListWrapItem