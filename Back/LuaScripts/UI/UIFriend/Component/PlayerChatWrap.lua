
---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by aaa.
--- DateTime: 2019/2/28 15:34
---
local itemData = DataUtil.GetData("item")
local PlayerChatWrap = BaseClass("PlayerChatWrap", UIWrapComponent)
local base = UIWrapComponent

-- 创建
local function OnCreate(self,holder)
    base.OnCreate(self)
    -- 组件初始化
    self.left_right = {{game = false,bg = false,content = false,lv = false,pre = "left"},
                       {game = false,bg = false,content = false,lv = false,pre = "right"}}
    for i, v in ipairs(self.left_right) do
        v.game = UIUtil.FindTrans(self.transform,v.pre).gameObject
        v.bg = UIUtil.FindComponent(self.transform,typeof(CS.UnityEngine.RectTransform),v.pre.."/"..v.pre.."bg")
        v.content = self:AddComponent(UIText,v.pre.."/"..v.pre.."bg".."/"..v.pre.."content")
        v.lv = self:AddComponent(UIText,v.pre.."/LvFrame/"..v.pre.."lv")
        v.frame = self:AddComponent(UIImage,v.pre.."/"..v.pre.."frame",AtlasConfig.DynamicTex)
        v.icon = self:AddComponent(UIImage,v.pre.."/"..v.pre.."icon",AtlasConfig.DynamicTex)
    end
    self.holder = holder
end

-- 组件被复用时回调该函数，执行组件的刷新
local function OnRefresh(self, real_index)
    local data = self.holder.chat_list[real_index]
    local comp = nil
    if data.is_mine then
        self.left_right[1].game:SetActive(false)
        comp = self.left_right[2]
        comp.icon:SetSpriteName(itemData[UserData:GetInstance().pHead].Icon)
        comp.frame:SetSpriteName(SpriteDefine:GetItemQualityFrameByType(itemData[UserData:GetInstance().pHead].Quality))
    else
        self.left_right[2].game:SetActive(false)
        comp = self.left_right[1]
        comp.icon:SetSpriteName(itemData[data.head].Icon)
        comp.frame:SetSpriteName(SpriteDefine:GetItemQualityFrameByType(itemData[data.head].Quality))
    end

    comp.game:SetActive(true)
    comp.content:SetText(data.content)
    comp.lv:SetText(data.lv)
    --TODO:设置气泡的大小 
    comp.bg.sizeDelta= data.size
end
PlayerChatWrap.OnCreate = OnCreate
PlayerChatWrap.OnRefresh = OnRefresh
return PlayerChatWrap