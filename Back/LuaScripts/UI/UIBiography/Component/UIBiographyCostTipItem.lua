---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2019/9/10 19:49
---
local UIBiographyCostTipItem = BaseClass("UIBiographyCostTipItem", UIWrapComponent)
local base = UIWrapComponent

local function SetActive(self, isActive)
    self.transform.gameObject:SetActive(isActive)
end

local function OnTipToggleValueChange(self,boo)
    BiographyData:GetInstance().isShowCostTip = not boo
end

local function OnResetLevelTimes(self, data)
    local totalBuyNum = #data.ResetCost
    if data.ResetTimes >= totalBuyNum then
        UISpecial:GetInstance():UITipText(DataUtil.GetClientText(100136))
        return
    end
    local haveCoin = BackpackData:GetInstance():GetItemNumById(CoinDefine.Diamond);
    local needCoin = data.ResetCost[data.ResetTimes + 1]
    if haveCoin >= needCoin then
        BiographyData:GetInstance():OnResetBiographyTimes(data.Id, needCoin)
    else
        UISpecial:GetInstance():UITipText(DataUtil.GetClientText(100081))
    end
end

local function OnCreate(self)
    base.OnCreate(self)
    self.titleText = self:AddComponent(UIText, "ParentLayout/titleTxt")
    self.closeBtn=self:AddComponent(UIButton,"ParentLayout/exitBtn");
    self.closeBtn:SetOnClick(function()
        LJAudioManger:GetInstance():PlayVoice("UI_Cancel")
        SetActive(self, false)
    end)
    self.maskBtn=self:AddComponent(UIButton,"mask");
    self.maskBtn:SetOnClick(function()
        LJAudioManger:GetInstance():PlayVoice("UI_Cancel")
        SetActive(self, false)
    end)
    self.certainBtn=self:AddComponent(UIButton,"ParentLayout/certainBtn");
    self.certainBtn:SetOnClick(function()
        LJAudioManger:GetInstance():PlayVoice("UI_CommonClick")
        SetActive(self, false)
        OnResetLevelTimes(self, self.data)
    end)
    self.cancelBtn=self:AddComponent(UIButton,"ParentLayout/cancelBtn");
    self.cancelBtn:SetOnClick(function()
        LJAudioManger:GetInstance():PlayVoice("UI_Cancel")
        SetActive(self, false)
    end)
    self.infoText = self:AddComponent(UIText, "ParentLayout/infoText")
    self.numText = self:AddComponent(UIText, "ParentLayout/numText")
    self.costIcon = self:AddComponent(UIImage, "ParentLayout/costIcon",AtlasConfig.DynamicTex)
    self.tipToggle=UIUtil.FindComponent(self.transform,typeof(CS.UnityEngine.UI.Toggle),"ParentLayout/tipToggle");
    self.tipToggle.onValueChanged:AddListener(BindCallback(self,OnTipToggleValueChange));
    SetActive(self, false)
end

local function OnEnable(self)
    base.OnEnable(self);
end
local function SetData(self, data)
    local totalBuyNum = #data.ResetCost
    if data.ResetTimes >= totalBuyNum then
        UISpecial:GetInstance():UITipText(DataUtil.GetClientText(100136))
        return
    end
    self.data = data
    SetActive(self, true)
    local staticItemData = DataUtil.GetData("item")
    self.costIcon:SetSpriteName(staticItemData[CoinDefine.Diamond].Icon);
    self.infoText:SetText(string.format(DataUtil.GetClientText(100139),data.ResetCost[data.ResetTimes + 1]))
    self.numText:SetText(string.format(DataUtil.GetClientText(100140),math.floor(totalBuyNum - data.ResetTimes)))
end

UIBiographyCostTipItem.OnCreate = OnCreate;
UIBiographyCostTipItem.OnEnable=OnEnable;
UIBiographyCostTipItem.SetData =SetData;
UIBiographyCostTipItem.SetActive = SetActive;
UIBiographyCostTipItem.OnResetLevelTimes = OnResetLevelTimes;
return UIBiographyCostTipItem;