---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by ljl.
--- DateTime: 2019/6/5 16:06
---
local PassNewArtifactItem = BaseClass("PassNewArtifactItem", UIBaseContainer)
local base = UIBaseContainer


local function OnCreate(self)
    base.OnCreate(self)
    self.haveLvObj=UIUtil.FindTrans(self.transform,"Subassembly_Level")
    self.isActiveObj = UIUtil.FindTrans(self.transform,"Subassembly_Locked")
    self.frame = self:AddComponent(UIImage,"Subassembly_BG")
    self.icon = self:AddComponent(UIImage,"Subassembly_Icon",AtlasConfig.DynamicTex)
    self.sliderText=self:AddComponent(UIText,"Subassembly_Level/Subassembly_Level_UIText")
    self.smallObj = UIUtil.FindTrans(self.transform,"Subassembly_Small")
    self.selfBtn=self:AddComponent(UIButton,"Subassembly_btn")
    self.redPoint = UIUtil.FindTrans(self.transform,"redPoint")
    self.icon_gray = self.icon:GetMat()
    self.selfBtn:SetOnClick(function ()
        LJAudioManger:GetInstance():PlayVoice("UI_CommonClick")
        self.view.SetBodySingleItemData(self.view,self.bodyData,false,self.transform)
    end)

end

local function LoadEffectObj(self)
    if self.TemptalentTitle_eff~=nil then
        self.TemptalentTitle_eff.effect.gameObject:SetActive(false)
        self.TemptalentTitle_eff.effect.gameObject:SetActive(true)
    else
        self.TemptalentTitle_eff = self:AddComponent(UIEffect, "Subassembly_Icon", 1, EffectConfig.UIArtifactBodyEffectShow)
    end
end

--刷新
local function Refresh(self,bodyData,_count,_data)
    self.bodyData=bodyData
    if bodyData == nil then
        return
    end
    local data = ArtifactsData:GetInstance():GetArtifactInfoByIdAndLevel(bodyData.artifact_id,bodyData.artifact_level_now,true)
    ArtifactsData:GetInstance():SetRedPointSetActive(data,bodyData.artifact_level_now,bodyData.artifact_level_max)
    self.redPoint.gameObject:SetActive(data.artifact_is_show_red_point == 1)

    if self.TemptalentTitle_eff~=nil then
        self.TemptalentTitle_eff.effect.gameObject:SetActive(false)
    end
    if _data ~= nil then
        if(bodyData.artifact_id == _data.artifact_id) then
            LoadEffectObj(self)
        else
            if self.TemptalentTitle_eff~=nil then
                self.TemptalentTitle_eff.effect.gameObject:SetActive(false)
            end
        end
    end
    self.haveLvObj.gameObject:SetActive(true)
    self.isActiveObj.gameObject:SetActive(false)
    if bodyData.artifact_level_now == 0 then
        self.icon:SetMat(self.icon_gray)
        self.frame:SetMat(self.icon_gray)
    else
        self.icon:SetMat(nil)
        self.frame:SetMat(nil)
    end
    self.icon:SetSpriteName(bodyData.artifact_icon)
    self.sliderText:SetText(bodyData.artifact_level_now.."/"..bodyData.artifact_level_max)
    local radius = 262
    if _count == 6 then
        if bodyData.artifact_pos == 1 then
            self.transform.localPosition = Vector2.New(0,radius)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, 0)
        elseif bodyData.artifact_pos == 2 then
            self.transform.localPosition = Vector2.New(radius * 0.866,radius * 0.5)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, -60)
        elseif bodyData.artifact_pos == 3 then
            self.transform.localPosition = Vector2.New(radius * 0.866,-radius * 0.5)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, -120)
        elseif bodyData.artifact_pos == 4 then
            self.transform.localPosition = Vector2.New(0,-radius)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, -180)
        elseif bodyData.artifact_pos == 5 then
            self.transform.localPosition = Vector2.New(-radius * 0.866,-radius * 0.5)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, 120)
        elseif bodyData.artifact_pos == 6 then
            self.transform.localPosition = Vector2.New(-radius * 0.866,radius * 0.5)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, 60)
        end
    elseif _count == 3 then
        if bodyData.artifact_pos == 1 then
            self.transform.localPosition = Vector2.New(0,radius)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, 0)
        elseif bodyData.artifact_pos == 2 then
            self.transform.localPosition = Vector2.New(radius * 0.866,radius * -0.5)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, -120)
        elseif bodyData.artifact_pos == 3 then
            self.transform.localPosition = Vector2.New(-radius * 0.866,radius * -0.5)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, 120)
        end
    elseif _count == 5 then
        if bodyData.artifact_pos == 1 then
            self.transform.localPosition = Vector2.New(0,radius)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, 0)
        elseif bodyData.artifact_pos == 2 then
            self.transform.localPosition = Vector2.New(radius * 0.95,radius * 0.3)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, -72)
        elseif bodyData.artifact_pos == 3 then
            self.transform.localPosition = Vector2.New(radius * 0.58,radius * -0.8)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, -144)
        elseif bodyData.artifact_pos == 4 then
            self.transform.localPosition = Vector2.New(-radius * 0.58,radius * -0.8)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, 144)
        elseif bodyData.artifact_pos == 5 then
            self.transform.localPosition = Vector2.New(-radius * 0.95,radius * 0.3)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, 72)
        end
    else
        if bodyData.artifact_pos == 1 then
            self.transform.localPosition = Vector2.New(0,radius)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, 0)
        elseif bodyData.artifact_pos == 2 then
            self.transform.localPosition = Vector2.New(radius * 0.7,radius * 0.7)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, -45)
        elseif bodyData.artifact_pos == 3 then
            self.transform.localPosition = Vector2.New(radius,0)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, -90)
        elseif bodyData.artifact_pos == 4 then
            self.transform.localPosition = Vector2.New(radius * 0.7,radius * -0.7)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, -135)
        elseif bodyData.artifact_pos == 5 then
            self.transform.localPosition = Vector2.New(0,-radius)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, -180)
        elseif bodyData.artifact_pos == 6 then
            self.transform.localPosition = Vector2.New(-radius * 0.7,radius * -0.7)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, 135)
        elseif bodyData.artifact_pos == 7 then
            self.transform.localPosition = Vector2.New(-radius,0)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, 90)
        elseif bodyData.artifact_pos == 8 then
            self.transform.localPosition = Vector2.New(-radius * 0.7,radius * 0.7)
            self.smallObj.localEulerAngles = Vector3.New(0, 0, 45)
        end
    end
    self.transform.localScale = Vector3.New(0.85,0.85,1)
end
PassNewArtifactItem.OnCreate=OnCreate
PassNewArtifactItem.Refresh=Refresh
return PassNewArtifactItem